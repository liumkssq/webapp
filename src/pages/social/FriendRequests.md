# FriendRequests.vue 文件说明文档

## 📄 文件概述

`FriendRequests.vue` 是校园交换平台中的好友请求管理页面组件，负责展示和处理用户收到的好友申请以及已发送的好友申请。该页面让用户能够接受、拒绝好友请求，并查看自己发出的请求状态。

## 📦 所属包

该文件位于 `src/pages/social` 目录下，是社交功能模块的主要页面组件之一。它管理好友请求相关的用户界面和交互逻辑。

## 🔍 核心结构

### 模板结构 (template)

1. **页面布局**：
   - 头部导航：显示标题和返回按钮
   - 标签页：包含"收到的请求"和"发送的请求"两个标签
   - 请求列表：显示收到或发送的好友请求
   - 操作按钮：接受/拒绝/撤回请求的按钮
   - 底部导航：应用通用导航栏

2. **主要组件**：
   - `HeaderNav`：顶部导航组件
   - `FooterNav`：底部导航组件
   - `van-tabs`：标签页切换组件
   - `van-list`：列表加载组件
   - `van-cell`：列表项组件
   - `van-button`：操作按钮组件
   - `van-empty`：空状态提示组件

### 脚本结构 (script)

1. **状态管理**：
   - `activeTab`：当前活动的标签页
   - `receivedRequests`：收到的好友请求列表
   - `sentRequests`：发送的好友请求列表
   - `loading`：各类加载状态控制
   - `receivedPage/sentPage`：分页控制

2. **方法**：
   - 数据加载：`loadReceivedRequests`、`loadSentRequests`
   - 分页加载：`loadMoreReceived`、`loadMoreSent`
   - 请求处理：`handleRequest`、`cancelFriendRequest`
   - 辅助功能：`formatTime`、`getInitials`、`getStatusText`

## 🔁 主要逻辑流程

1. **页面初始化流程**：
   - 组件挂载时加载收到的好友请求
   - 同时加载发送的好友请求
   - 更新Store中的好友请求未读数量

2. **请求处理流程**：
   - 用户对收到的请求点击接受或拒绝
   - 调用 `handleFriendRequest` API处理请求
   - 更新本地状态和显示
   - 接受好友后更新好友列表

3. **请求撤回流程**：
   - 用户对已发送的请求点击撤回
   - 调用 `cancelFriendRequest` API取消请求
   - 更新本地状态和显示

4. **分页加载流程**：
   - 用户滚动到列表底部触发加载更多
   - 根据当前标签页加载相应类型的更多请求
   - 更新列表并控制分页状态

## 📌 特别说明

1. **数据加载策略**：
   - 初始化时并行加载两种请求列表
   - 支持分页加载，每页默认20条记录
   - 加载完所有数据后显示"暂无更多请求"提示

2. **请求状态管理**：
   - 请求状态包括：等待验证、已接受、已拒绝、已撤回
   - 不同状态显示不同颜色和操作按钮
   - 状态变更后实时更新UI显示

3. **时间格式化**：
   - 使用 `date-fns` 库进行相对时间格式化
   - 显示"几分钟前"、"几小时前"等相对时间
   - 支持中文本地化显示

4. **Store更新**：
   - 接受好友请求后自动更新好友列表
   - 处理请求后更新未读请求数量
   - 确保数据在组件和Store之间保持一致

5. **空状态处理**：
   - 无收到请求时显示"暂无收到的好友请求"
   - 无发送请求时显示"暂无发送的好友请求"并提供添加好友按钮
   - 加载中状态显示加载动画